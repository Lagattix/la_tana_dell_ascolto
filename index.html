<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>La tana dell'ascolto</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-gradient-to-br from-purple-900 via-purple-800 to-indigo-900 text-white">

<div class="p-6 pb-32 max-w-7xl mx-auto">

<header class="mb-8">
<h1 class="text-4xl font-bold flex items-center gap-3">
ðŸŽ§ La tana dell'ascolto
</h1>
<p class="text-purple-200">Crea podcast. Poi racconta storie.</p>
</header>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

<!-- LISTA PODCAST -->
<div class="bg-white/10 rounded-2xl p-6">
<div class="flex justify-between items-center mb-4">
<h2 class="text-2xl font-semibold">Podcast</h2>
<button id="btnAddPodcast" class="bg-purple-500 px-3 py-1 rounded">+</button>
</div>

<!-- FORM PODCAST -->
<div id="addForm" class="hidden space-y-2 mb-4">
<input id="imgInput" type="file" accept="image/*" class="w-full">
<input id="titleInput" placeholder="Titolo" class="w-full p-2 bg-white/10 rounded">
<input id="authorInput" placeholder="Autore" class="w-full p-2 bg-white/10 rounded">
<textarea id="descInput" placeholder="Descrizione" class="w-full p-2 bg-white/10 rounded"></textarea>
<button id="savePodcast" class="w-full bg-green-500 py-2 rounded">Crea podcast</button>
</div>

<div id="podcastList" class="space-y-2"></div>
</div>

<!-- DETTAGLI -->
<div class="lg:col-span-2 bg-white/10 rounded-2xl p-6">
<div id="empty" class="text-center text-purple-300">Seleziona un podcast</div>

<div id="details" class="hidden space-y-4">
<img id="detailImg" class="w-40 h-40 object-cover rounded-xl">
<h2 id="detailTitle" class="text-3xl font-bold"></h2>
<p id="detailAuthor" class="text-purple-200"></p>
<p id="detailDesc" class="text-purple-300"></p>

<button id="addEpisodeBtn" class="hidden bg-purple-500 px-4 py-2 rounded">
âž• Aggiungi episodio
</button>

<div id="episodes" class="space-y-2"></div>
</div>
</div>

</div>
</div>

<!-- PLAYER -->
<audio id="audio"></audio>

<script>
/* USER */
let userId = localStorage.getItem("userId");
if (!userId) {
  userId = crypto.randomUUID();
  localStorage.setItem("userId", userId);
}

/* DATA */
let podcasts = [];
let selected = null;

/* DOM */
const podcastList = document.getElementById("podcastList");
const addForm = document.getElementById("addForm");
const details = document.getElementById("details");
const empty = document.getElementById("empty");
const addEpisodeBtn = document.getElementById("addEpisodeBtn");

/* EVENTS */
document.getElementById("btnAddPodcast").onclick = () => {
  addForm.classList.toggle("hidden");
};

document.getElementById("savePodcast").onclick = () => {
  const imgFile = document.getElementById("imgInput").files[0];
  if (!imgFile) return alert("Serve un'immagine");

  const reader = new FileReader();
  reader.onload = () => {
    podcasts.push({
      id: Date.now(),
      title: titleInput.value,
      author: authorInput.value,
      description: descInput.value,
      image: reader.result,
      creatorId: userId,
      episodes: []
    });
    addForm.classList.add("hidden");
    render();
  };
  reader.readAsDataURL(imgFile);
};

/* RENDER */
function render() {
  podcastList.innerHTML = podcasts.map(p => `
    <div onclick="openPodcast(${p.id})"
      class="p-3 bg-white/5 rounded cursor-pointer hover:bg-white/10">
      <h3 class="font-semibold">${p.title}</h3>
      <p class="text-sm text-purple-200">${p.author}</p>
    </div>
  `).join("");
}

window.openPodcast = (id) => {
  selected = podcasts.find(p => p.id === id);
  empty.classList.add("hidden");
  details.classList.remove("hidden");

  detailImg.src = selected.image;
  detailTitle.textContent = selected.title;
  detailAuthor.textContent = selected.author;
  detailDesc.textContent = selected.description;

  episodes.innerHTML = selected.episodes.length
    ? selected.episodes.map(e => `<div class="bg-white/5 p-2 rounded">${e.title}</div>`).join("")
    : `<p class="text-purple-300">Nessun episodio</p>`;

  if (selected.creatorId === userId) {
    addEpisodeBtn.classList.remove("hidden");
  } else {
    addEpisodeBtn.classList.add("hidden");
  }
};

render();
</script>

</body>
</html>
